<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Blog | DebtReliefGuard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Transparent, FTC-aligned debt relief insights and guides." />
  <meta name="robots" content="index,follow" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0;color:#111;background:#fff}
    .wrap{max-width:1040px;margin:0 auto;padding:16px}
    header.hero{background:#0b3b66;color:#fff;padding:28px 16px;margin:0 0 12px}
    header.hero h1{margin:0;font-size:1.9rem;line-height:1.2}
    .muted{color:#e8eef7}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{border:1px solid #e7e7e7;border-radius:16px;overflow:hidden;background:#fff;display:block}
    .card img{width:100%;height:160px;object-fit:cover;display:block}
    .p{padding:14px}
    .card h3{margin:0 0 6px;font-size:1.15rem;line-height:1.3}
    .card .meta{color:#666;font-size:.9rem;margin-bottom:8px}
    a{text-decoration:none;color:inherit}
    a:focus-visible{outline:3px solid #7aa7ff;outline-offset:3px;border-radius:8px}
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <a href="/" style="color:#fff;text-decoration:none;">DebtReliefGuard</a>
      <div class="muted" style="margin-top:6px">Your guide to debt relief—FTC-aligned, no hype.</div>
      <h1 style="margin-top:8px">Latest Posts</h1>
    </div>
  </header>

  <main class="wrap">
    <div id="list" class="grid" aria-live="polite"></div>
    <p id="err" class="muted" style="color:#666;display:none">Sorry, we couldn’t load the blog list.</p>
  </main>

  <script>
  (async () => {
    const qs = (s) => document.querySelector(s);
    const listEl = qs('#list'); const errEl = qs('#err');
    const normSlug = (s) => String(s||'').trim().replace(/(^\/+|\/+$)/g,'').replace(/\.html$/,'');
    const isDatedHtml = (u) => /^\/blog\/\d{4}-\d{2}-\d{2}-.+\.html$/i.test(u||'');

    function pickUrl(p){
      if (isDatedHtml(p?.url)) return p.url;
      if (isDatedHtml(p?.content_url)) return p.content_url;
      const s = normSlug(p?.slug);
      return s ? `/blog/${s}.html` : '#';
    }

    function card(p){
      const href = pickUrl(p);
      const img = p?.image || '/images/og-cover.jpg';
      const title = p?.title || 'Untitled';
      const tags = Array.isArray(p?.tags) && p.tags.length ? p.tags.join(', ') : '';
      const excerpt = p?.excerpt || p?.description || '';
      const a = document.createElement('a');
      a.href = href; a.className = 'card'; a.rel = 'noopener noreferrer';
      a.innerHTML = `
        <img src="${img}" alt="" loading="lazy" decoding="async" width="640" height="360">
        <div class="p">
          <h3>${title}</h3>
          <div class="meta">${tags}</div>
          <p class="meta" style="margin:0">${excerpt}</p>
        </div>`;
      return a;
    }

    async function fetchJSON(url, ms=8000){
      const ctrl = new AbortController(); const id = setTimeout(()=>ctrl.abort(), ms);
      try{
        const res = await fetch(url, {headers:{Accept:'application/json'},cache:'no-store',signal:ctrl.signal});
        if(!res.ok) throw new Error(url+' HTTP '+res.status);
        const ct = (res.headers.get('content-type')||'').toLowerCase();
        return ct.includes('application/json') ? res.json() : JSON.parse(await res.text());
      } finally { clearTimeout(id); }
    }

    try{
      const data = await fetchJSON('/blogs.json?ts='+Date.now());
      const items = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);
      listEl.innerHTML = '';
      items.forEach(p => listEl.appendChild(card(p)));
    }catch(e){
      console.error(e); errEl.style.display = 'block';
    }

    // Telemetry: send
    const payload = JSON.stringify({stage:'list_view', at:new Date().toISOString(), ua:navigator.userAgent});
    ['/api/015-telemetry-collector','/api/016-telemetry-rollups','/api/050-ai-loop-optimizer','/api/057-heat-map-tracker']
      .forEach(u => fetch(u,{method:'POST',body:payload,headers:{'content-type':'application/json'},keepalive:true}).catch(()=>{}));

    // Telemetry: best-effort receive (050)
    try {
      const r = await fetch('/api/050-ai-loop-optimizer?surface=blog_index', {cache:'no-store'});
      if (r.ok) {
        const j = await r.json().catch(()=>null);
        if (j?.variant) document.documentElement.setAttribute('data-ab-variant', j.variant);
      }
    } catch {}
  })();
  </script>
</body>
</html>
