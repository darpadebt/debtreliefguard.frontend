<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loading… | DebtReliefGuard</title>
  <meta name="description" content="Loading blog post…" />
  <meta name="robots" content="index,follow" />

  <!-- Base theme alignment -->
  <style>
    :root{
      --brand:#0b5fff; --brand-ink:#0a3ea8; --ink:#0a1a2a; --ink-2:#334155;
      --bg:#ffffff; --bg-2:#f8fafc; --radius:18px; --shadow:0 6px 24px rgba(2,12,27,.08);
      --z-nav:1000; --z-callbar:1001;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:860px;margin:0 auto;padding:96px 16px 108px;}
    /* Sticky Top Nav */
    .topnav{
      position:sticky; top:0; z-index:var(--z-nav);
      backdrop-filter:saturate(1.2) blur(6px);
      background:rgba(255,255,255,.85); border-bottom:1px solid #e5e7eb;
    }
    .topnav-inner{max-width:1080px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:14px;}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--ink)}
    .logo svg{width:28px;height:28px}
    .navspacer{flex:1}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;border:1px solid #e5e7eb;box-shadow:var(--shadow);background:#fff}
    .btn-primary{background:var(--brand);color:#fff;border-color:var(--brand-ink)}
    /* Article */
    article h1{font-size:34px;line-height:1.2;margin:0 0 10px}
    .post-meta{color:var(--ink-2);font-size:14px;margin:0 0 18px}
    .hero{width:100%;border-radius:14px;box-shadow:var(--shadow);margin:16px 0}
    .prose h2{font-size:24px;margin-top:22px}
    .prose p{margin:12px 0;color:var(--ink)}
    /* Sticky Bottom Call Bar */
    .callbar{
      position:fixed;left:0;right:0;bottom:0;z-index:var(--z-callbar);
      background:#0b1220; color:#fff; border-top:1px solid #1f2937;
    }
    .callbar-inner{max-width:1080px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:12px}
    .callbar .cta{margin-left:auto}
    .phone{font-weight:700}
    .backlink{font-size:14px;color:#cbd5e1}
    @media (max-width:640px){
      .topnav-inner{padding:12px 12px}
      .container{padding:84px 12px 96px}
    }
  </style>
</head>
<body>
  <!-- Sticky Top Nav (mirrors index.html look/feel) -->
  <header class="topnav" id="site-header" data-worker-bar="true">
    <div class="topnav-inner">
      <a class="logo" href="/">
        <svg viewBox="0 0 24 24" fill="none"><path d="M4 12a8 8 0 1116 0 8 8 0 01-16 0z" stroke="currentColor" stroke-width="2"/><path d="M8 13l3 3 5-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span>DebtReliefGuard</span>
      </a>
      <nav class="navspacer"></nav>
      <a class="btn" href="/blog.index.html">All Articles</a>
      <a class="btn" href="/#faq">FAQ</a>
      <a class="btn btn-primary" href="/#get-started">Get Started</a>
    </div>
  </header>

  <!-- Main -->
  <main class="container" id="main">
    <article id="post">
      <h1 id="post-title">Loading…</h1>
      <p class="post-meta" id="post-meta"></p>
      <img id="post-hero" class="hero" alt="" style="display:none" />
      <div class="prose" id="post-content" aria-live="polite" aria-busy="true">Please wait…</div>
    </article>
  </main>

  <!-- Sticky Bottom Call Bar -->
  <aside class="callbar" id="call-bar">
    <div class="callbar-inner">
      <a class="backlink" href="/blog.index.html">← Back to all articles</a>
      <span class="phone" style="margin-left:16px">Call: <a href="tel:7275578090" style="color:#fff;text-decoration:underline">727-557-8090</a></span>
      <div class="cta">
        <a class="btn btn-primary" href="/#get-started">Free Consultation</a>
      </div>
    </div>
  </aside>

  <!-- Scripts -->
  <script>
    // ---- Worker Beacons (015,016,050,057) ----
    (function(){
      const send = (path, body) => {
        try {
          const url = path + (path.includes('?') ? '&' : '?') + 't=' + Date.now();
          if (navigator.sendBeacon) {
            const blob = new Blob([JSON.stringify(body)], {type:'application/json'});
            navigator.sendBeacon(url, blob);
          } else {
            fetch(url,{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(body)});
          }
        } catch(e){/* noop */}
      };
      const ctx = {
        page:'blog.slug', ts: Date.now(),
        ua: navigator.userAgent, ref: document.referrer || null,
        slug: (location.pathname.split('/').pop() || '').replace(/\.html$/,'')
      };
      send('/api/015', {...ctx, worker:'015'});
      send('/api/016', {...ctx, worker:'016'});
      send('/api/050', {...ctx, worker:'050'});
      send('/api/057', {...ctx, worker:'057'});
    })();

    // ---- Post Loader (uses your existing blogs.json + static HTML fallback) ----
    (async function(){
      const isPreview = /chatgpt\.com$/i.test(location.hostname) || location.hostname.includes('chatgpt');
      const siteOrigin = isPreview ? 'https://debtreliefguard.com' : location.origin;
      const slug = (() => {
        const trimmedPath = location.pathname.replace(/\/+$/, '');
        const segment = trimmedPath.split('/').pop() || '';
        return segment.replace(/\.html$/, '');
      })();
      const titleEl = document.getElementById('post-title');
      const metaEl  = document.getElementById('post-meta');
      const heroEl  = document.getElementById('post-hero');
      const bodyEl  = document.getElementById('post-content');
      const defaultHero = '/images/debt-relief-guide/hero-01.jpg';

      const toAbsolute = (value) => {
        if (!value || typeof value !== 'string') return '';
        try { return new URL(value, siteOrigin).href; }
        catch(_) { return value; }
      };

      const originUrl = (() => {
        try { return new URL(siteOrigin).origin; }
        catch(_) { return siteOrigin; }
      })();

      const normalizePostUrl = (value) => {
        if (typeof value !== 'string') return '';
        const raw = value.trim();
        if (!raw) return '';
        try {
          const url = new URL(raw, siteOrigin);
          const isRelative = !/^https?:\/\//i.test(raw);
          const sameOrigin = isRelative || url.origin === originUrl;
          const match = url.pathname.match(/^\/blog\/([^\/]+)\.html$/);
          if (match && match[1] && !/^\d{4}-\d{2}-\d{2}-/.test(match[1])) {
            const path = url.pathname.replace(/\.html$/, '');
            const rebuilt = `${path}${url.search}${url.hash}`;
            return sameOrigin ? rebuilt : `${url.origin}${rebuilt}`;
          }
          return sameOrigin ? `${url.pathname}${url.search}${url.hash}` : url.href;
        } catch (_) {
          if (/^\/blog\/[^\/]+\.html(?:[?#].*)?$/i.test(raw) && !/^\/blog\/\d{4}-\d{2}-\d{2}-/i.test(raw)) {
            return raw.replace(/\.html(?=[?#]|$)/, '');
          }
          return raw;
        }
      };

      const applyOgImage = (value) => {
        if (!value || typeof value !== 'string') return;
        const absolute = toAbsolute(value);
        if (!absolute) return;
        ensureMeta('meta[property="og:image"]', { content: absolute });
        ensureMeta('meta[name="twitter:image"]', { content: absolute });
      };

      const ensureMeta = (selector, attrs) => {
        if (!attrs || typeof attrs !== 'object') return;
        let node = document.head.querySelector(selector);
        if (!node) {
          node = document.createElement('meta');
          if (selector.includes('[name="')) node.setAttribute('name', selector.split('[name="')[1].split('"')[0]);
          if (selector.includes('[property="')) node.setAttribute('property', selector.split('[property="')[1].split('"')[0]);
          document.head.appendChild(node);
        }
        Object.entries(attrs).forEach(([k,v]) => {
          if (typeof v === 'string' && v) node.setAttribute(k, v);
        });
      };

      // 1) Try to locate the entry in blogs.json (for meta, hero, canonical URL)
      let entry = null;
      try{
        const blogsSrc = isPreview ? 'https://debtreliefguard.com/blogs.json' : '/blogs.json';
        const res = await fetch(blogsSrc, {cache:'no-store'});
        const list = await res.json();
        if(Array.isArray(list)){
          const matchesEntrySlug = (value) => {
            if (typeof value !== 'string') return false;
            const cleaned = value.trim();
            if (!cleaned) return false;
            const withoutHash = cleaned.split('#')[0];
            const withoutQuery = withoutHash.split('?')[0];
            const withoutIndex = withoutQuery.replace(/\/index(?:\.html)?$/i, '');
            const trimmed = withoutIndex.replace(/\/+$/, '');
            const segments = trimmed.split('/').filter(Boolean);
            if (!segments.length) return false;
            const last = segments[segments.length - 1].replace(/\.html$/i, '');
            if (!last) return false;
            return last === slug || last.endsWith(`-${slug}`);
          };  
          
          entry = list.find(p => {
            if(!p || typeof p !== 'object') return false;
            const site = (p.site || '').toString().toLowerCase();
            if(site && site !== 'debtreliefguard') return false;
            const slugMatch = typeof p.slug === 'string' && p.slug === slug;
            const urlMatch = matchesEntrySlug(p.url);
            const contentMatch = matchesEntrySlug(p.content_url);
            return slugMatch || urlMatch || contentMatch;
          }) || null;
        }
      }catch(_){}

      // 2) Build the list of candidate content URLs (prefer undated /blog/<slug>, then dated variants)
      const resolveHref = (value) => {
        if (!value || typeof value !== 'string') return '';
        try {
          return new URL(value, siteOrigin).href;
        } catch (_) {
          return '';
        }
      };

      const isDatedHref = (href) => {
        try {
          const url = new URL(href, siteOrigin);
          const path = url.pathname.toLowerCase();
          return /^\/blog\/20\d{2}-\d{2}-\d{2}-/.test(path) || /^\/content\/blog\/20\d{2}-\d{2}-\d{2}-/.test(path);
        } catch (_) {
          return false;
        }
      };

      const candidateHrefSet = new Set();
      const undated = [];
      const dated = [];
      const pushCandidate = (value) => {
        const href = resolveHref(value);
        if (!href || candidateHrefSet.has(href)) return;
        candidateHrefSet.add(href);
        if (isDatedHref(href)) dated.push(href);
        else undated.push(href);
      };

      pushCandidate(entry?.url);
      pushCandidate(entry?.content_url);

      if (!candidateHrefSet.size) {
        if (/^20\d{2}-\d{2}-\d{2}-/.test(slug)) {
          pushCandidate(`/blog/${slug}.html`);
        } else {
          pushCandidate(`/blog/${slug}.html`);
          pushCandidate(`/blog/${slug}/index.html`);
        }
      }

      const candidateHrefs = [...dated, ...undated].sort((a, b) => {
        const score = (href) => {
          try {
            const url = new URL(href, siteOrigin);
            return url.pathname.startsWith('/content/blog/') ? 0 : 1;
          } catch (_) {
            return href.includes('/content/blog/') ? 0 : 1;
          }
        };
        return score(a) - score(b);
      });
      const primaryHref = candidateHrefs[0] || resolveHref(`/blog/${slug}.html`);

      // 3) Fetch the HTML content & inject
      const isLoaderShell = (html) => {
        if (!html || typeof html !== 'string') return false;
        const probe = document.createElement('div');
        probe.innerHTML = html;
        const loaderArticle = probe.querySelector('article#post');
        if (!loaderArticle) return false;
        const loaderContent = loaderArticle.querySelector('#post-content');
        const loaderTitle = loaderArticle.querySelector('#post-title');
        const text = loaderContent && loaderContent.textContent ? loaderContent.textContent.trim().toLowerCase() : '';
        const title = loaderTitle && loaderTitle.textContent ? loaderTitle.textContent.trim().toLowerCase() : '';
        if (!text && !title) return false;
        const isPlaceholderText = text.startsWith('please wait') || text === 'loading' || text === 'loading…' || text === 'loading...';
        const isPlaceholderTitle = title === 'loading…' || title === 'loading...' || title === 'loading';
        return isPlaceholderText || isPlaceholderTitle;
      };
      
      const fetchHtml = async (href) => {
        const response = await fetch(href, { cache: 'no-store' });
        if (!response.ok) {
          throw new Error(`Failed to load ${href} (${response.status})`);
        }
        const text = await response.text();
        if (isLoaderShell(text)) {
          throw new Error(`Loaded placeholder shell from ${href}`);
        }
        return text;
      };

      const fallbackHrefs = (() => {
        const list = [];
        const seen = new Set();
        const push = (href) => {
          if (!href || seen.has(href) || href === primaryHref) return;
          seen.add(href);
          list.push(href);
        };
        const addOpposite = (href) => {
          try {
            const url = new URL(href, siteOrigin);
            if (url.origin !== originUrl) return;
            if (url.pathname.startsWith('/blog/')) {
              push(`${url.origin}/content${url.pathname}${url.search}${url.hash}`);
            } else if (url.pathname.startsWith('/content/blog/')) {
              const altPath = url.pathname.replace(/^\/content/, '');
              push(`${url.origin}${altPath}${url.search}${url.hash}`);
            }
          } catch (_) { /* noop */ }
        };

        addOpposite(primaryHref);

        for (let i = 1; i < candidateHrefs.length; i++) {
          const candidate = candidateHrefs[i];
          push(candidate);
          addOpposite(candidate);
        }
        
        return list;
      })();

      const fetchQueue = [primaryHref, ...fallbackHrefs].filter(Boolean);
      const errors = [];
      let html = '';
      for (const href of fetchQueue) {
        try {
          html = await fetchHtml(href);
          break;
        } catch (err) {
          errors.push(err);
        }
      }
      if (!html) {
        if (errors.length) {
          console.error('Unable to fetch blog article HTML from any known location.', ...errors);
          throw errors[errors.length - 1];
        }
        throw new Error('No candidate URLs available for blog article.');
      }

        // Extract <article>… if present; else use whole document
        const tmp = document.createElement('div');
        tmp.innerHTML = html;
        const article = tmp.querySelector('article') || tmp;

        // Title
        const h1 = article.querySelector('h1');
        const derivedTitle = (entry?.title) || (h1 ? h1.textContent.trim() : 'Untitled');
        titleEl.textContent = derivedTitle;
        // Hero image
        const hero = article.querySelector('img');
        const heroSrc = entry?.thumbnail || entry?.image || hero?.getAttribute('src') || '';
        const fallbackHero = () => {
          if (heroEl.dataset.fallbackApplied === '1') {
            heroEl.style.display = 'none';
            return;
          }
          heroEl.dataset.fallbackApplied = '1';
          heroEl.src = defaultHero;
          heroEl.style.display = '';
          if (!heroEl.alt) heroEl.alt = 'DebtReliefGuard blog hero';
          applyOgImage(defaultHero);
        };
        heroEl.addEventListener('error', () => {
          fallbackHero();
        });
        heroEl.addEventListener('load', () => {
          if (heroEl.dataset.fallbackApplied === '1') return;
          if (heroEl.naturalWidth <= 1 || heroEl.naturalHeight <= 1) {
            fallbackHero();
          }
        });

        if (heroSrc){
          heroEl.src = heroSrc;
          heroEl.style.display = '';
          if (entry?.title) heroEl.alt = `${entry.title} hero image`;
          applyOgImage(heroSrc);
        } else {
          fallbackHero();
        }

        // Meta
        const formatDate = (value) => {
          if(!value) return '';
          const parsed = new Date(value);
          return isNaN(parsed.getTime()) ? '' : parsed.toLocaleDateString();
        };
        const date = formatDate(entry?.date_published || entry?.published_at);
        const author = (() => {
          if (!entry?.author) return 'DebtReliefGuard';
          const value = Array.isArray(entry.author) ? entry.author.join(', ') : String(entry.author);
          return value.trim() || 'DebtReliefGuard';
        })();
        metaEl.textContent = [date, author].filter(Boolean).join(' · ');

        // Body (remove first h1/hero if duplicated, then inject)
        if (h1) h1.remove();
        if (hero && hero.src && heroEl.src && hero.src === heroEl.src) hero.remove();
        bodyEl.innerHTML = article.innerHTML;
        bodyEl.setAttribute('aria-busy','false');

        // Update document <title> & description if available
        if (entry?.title) document.title = `${entry.title} | DebtReliefGuard`;
        if (entry?.excerpt){
          let metaDesc = document.querySelector('meta[name="description"]');
          if (!metaDesc){
            metaDesc = document.createElement('meta');
            metaDesc.setAttribute('name','description');
            document.head.appendChild(metaDesc);
          }
          metaDesc.setAttribute('content', entry.excerpt);
        }
        const canonicalCandidate = normalizePostUrl(entry?.canonical_url || entry?.url || `/blog/${slug}`);
        if (canonicalCandidate){
          const canonicalUrl = toAbsolute(canonicalCandidate);
          if (canonicalUrl){
            let canonical = document.querySelector('link[rel="canonical"]');
            if (!canonical){
              canonical = document.createElement('link');
              canonical.setAttribute('rel','canonical');
              document.head.appendChild(canonical);
            }
            canonical.setAttribute('href', canonicalUrl);
            ensureMeta('meta[property="og:url"]', { content: canonicalUrl });
            ensureMeta('meta[name="twitter:url"]', { content: canonicalUrl });
          }
        }

        if (entry?.title) {
          ensureMeta('meta[property="og:title"]', { content: `${entry.title} | DebtReliefGuard` });
          ensureMeta('meta[name="twitter:title"]', { content: `${entry.title} | DebtReliefGuard` });
        }
        if (entry?.excerpt) {
          ensureMeta('meta[property="og:description"]', { content: entry.excerpt });
          ensureMeta('meta[name="twitter:description"]', { content: entry.excerpt });
        }
        ensureMeta('meta[property="og:type"]', { content: 'article' });
        ensureMeta('meta[name="twitter:card"]', { content: 'summary_large_image' });
        const published = entry?.date_published || entry?.published_at;
        ensureMeta('meta[name="author"]', { content: author });
        if (entry?.author) {
          ensureMeta('meta[name="author"]', { content: entry.author });
        }

        if (entry?.schema_jsonld) {
          const existing = document.getElementById('dynamic-schema-jsonld');
          if (existing) existing.remove();
          const script = document.createElement('script');
          script.type = 'application/ld+json';
          script.id = 'dynamic-schema-jsonld';
          try {
            let schema = entry.schema_jsonld;
            if (typeof schema === 'string') {
              try {
                schema = JSON.parse(schema);
              } catch (_) {
                schema = schema.trim();
              }
            }
            if (typeof schema === 'string') {
              script.textContent = schema;
            } else {
              script.textContent = JSON.stringify(schema);
            }
            document.head.appendChild(script);
          } catch(_) {}
        }
      }catch(err){
        titleEl.textContent = 'Post not found';
        bodyEl.innerHTML = `<p>We couldn’t load this article. Please go back to the <a href="/blog.index.html">blog list</a>.</p>`;
        bodyEl.setAttribute('aria-busy','false');
      }
    })();
  </script>
</body>
</html>
