<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Blog | DebtReliefGuard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Latest debt relief guides and comparisons." />
  <meta name="robots" content="index,follow" />
  <link rel="preload" href="/blogs.json" as="fetch" crossorigin="anonymous" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0;color:#111;background:#fff}
    .wrap{max-width:1040px;margin:0 auto;padding:16px}
    header.hero{background:#0b3b66;color:#fff;padding:28px 16px;margin:0 0 12px}
    header.hero h1{margin:0;font-size:1.9rem;line-height:1.2}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{border:1px solid #e7e7e7;border-radius:16px;overflow:hidden;background:#fff}
    .card img{width:100%;height:160px;object-fit:cover;display:block}
    .card .p{padding:14px}
    .card h3{margin:0 0 6px;font-size:1.15rem;line-height:1.3}
    .muted{color:#666}
    a{text-decoration:none;color:inherit}
    a:focus-visible{outline:3px solid #7aa7ff;outline-offset:3px;border-radius:8px}
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <a href="/" style="color:#fff;text-decoration:none;">DebtReliefGuard</a>
      <h1 style="margin-top:6px">Latest Posts</h1>
      <p class="muted" style="margin:8px 0 0">Transparent, FTC-aligned insights to help you choose confidently.</p>
    </div>
  </header>

  <main class="wrap">
    <div id="list" class="grid" aria-live="polite"></div>
    <p id="err" class="muted" style="display:none">Sorry, we couldnâ€™t load the blog list.</p>
  </main>

  <script>
  (async () => {
    const qs = (s) => document.querySelector(s);
    const listEl = qs('#list'); const errEl = qs('#err');
    const normSlug = (s) => String(s||'').trim().replace(/(^\/+|\/+$)/g,'').replace(/\.html$/,'');
    const isDatedHtml = (u) => /^\/blog\/\d{4}-\d{2}-\d{2}-.+\.html$/i.test(u||'');

    function pickUrl(p){
      // Preferred: explicit dated .html URL under /blog
      if (isDatedHtml(p?.url)) return p.url;
      if (isDatedHtml(p?.content_url)) return p.content_url;
      // Fallback: build a physical file path from slug (safe because redirects pass through *.html)
      const s = normSlug(p?.slug);
      return s ? `/blog/${s}.html` : '#';
    }

    function card(p){
      const href = pickUrl(p);
      const img = p?.image || '/images/og-cover.jpg';
      const title = p?.title || 'Untitled';
      const tags = Array.isArray(p?.tags) && p.tags.length ? p.tags.join(', ') : '';
      const excerpt = p?.excerpt || p?.description || '';
      const a = document.createElement('a'); a.href = href; a.className = 'card'; a.rel = 'noopener';
      a.innerHTML = `
        <img src="${img}" alt="">
        <div class="p">
          <h3>${title}</h3>
          <div class="muted" style="font-size:.9rem;margin-bottom:8px">${tags}</div>
          <p class="muted" style="margin:0">${excerpt}</p>
        </div>`;
      return a;
    }

    try{
      const res = await fetch('/blogs.json?ts='+Date.now(), {cache:'no-store'});
      if(!res.ok) throw new Error('blogs.json HTTP '+res.status);
      const data = await res.json();
      const items = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);
      listEl.innerHTML = '';
      items.forEach(p => listEl.appendChild(card(p)));
    }catch(e){
      console.error(e); errEl.style.display = 'block';
    }

    // best-effort telemetry (non-blocking)
    const payload = JSON.stringify({stage:'list_view', at:new Date().toISOString(), ua:navigator.userAgent});
    ['/api/015-telemetry-collector','/api/016-telemetry-rollups','/api/050-ai-loop-optimizer','/api/057-heat-map-tracker']
      .forEach(u => fetch(u,{method:'POST',body:payload,headers:{'content-type':'application/json'},keepalive:true}).catch(()=>{}));
  })();
  </script>
</body>
</html>
